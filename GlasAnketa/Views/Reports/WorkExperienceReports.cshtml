@model List<WorkExperienceReportVM>

@{
    ViewData["Title"] = "Work Experience Reports";
}

<div class="reports-container">
    <div class="report-header">
        <div class="header-content">
            <h1>üíº Work Experience Reports</h1>
            <p>Responses and averages grouped by work experience ranges</p>
        </div>
        <a href="@Url.Action("Index", "Reports")" class="btn btn-back">‚Üê Back</a>
    </div>
    <div class="filter-bar">
        <form method="get" action="@Url.Action("WorkExperienceReports", "Reports")" class="filter-form">
            <label for="experienceRange">Work Experience:</label>
            <select id="experienceRange" name="experienceRange">
                @{ var selected = Context.Request.Query["experienceRange"].ToString(); }
                <option value="" selected="@(string.IsNullOrEmpty(selected) ? "selected" : null)">All</option>
                <option value="< 5" selected="@(selected == "< 5" ? "selected" : null)">&lt; 5</option>
                <option value="5 - 10" selected="@(selected == "5 - 10" ? "selected" : null)">5 - 10</option>
                <option value="10 - 15" selected="@(selected == "10 - 15" ? "selected" : null)">10 - 15</option>
                <option value="15 - 20" selected="@(selected == "15 - 20" ? "selected" : null)">15 - 20</option>
                <option value="> 20" selected="@(selected == "> 20" ? "selected" : null)">&gt; 20</option>
            </select>
            <button type="submit" class="btn btn-primary">Filter</button>
        </form>
        <form method="post" action="@Url.Action("ExportWorkExperienceReports", "Reports")">
            <input type="hidden" name="experienceRange" value="@Context.Request.Query["experienceRange"]" />
            <button type="submit" class="btn btn-secondary">üì§ Export CSV</button>
        </form>
    </div>

    @if (Model == null)
    {
        <div class="alert alert-warning">
            <strong>‚ö†Ô∏è No Data Available</strong>
            <p>No work experience report data is currently available.</p>
        </div>
    }
    else if (!Model.Any())
    {
        <div class="alert alert-info">
            <strong>üìã No Answers Found</strong>
            <p>No answers were found for the selected filter.</p>
        </div>
    }
    else
    {
        <div class="report-table-container">
            @{ var role = Context.Session.GetString("UserRole"); var isAdmin = string.Equals(role, "Administrator", StringComparison.OrdinalIgnoreCase); }
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Work Experience</th>
                        @if (isAdmin)
                        {
                            <th>Users</th>
                        }
                        <th>Questions Answered</th>
                        <th>Sum of Scale Values</th>
                        <th>Average (Sum / Questions)</th>
                        @if (isAdmin)
                        {
                            <th>CompanyIds</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.ExperienceRange</td>
                            @if (isAdmin)
                            {
                                <td>@item.CountUsers</td>
                            }
                            <td>@item.QuestionsAnswered</td>
                            <td>@item.TotalScaleValue</td>
                            <td>@item.AverageScaleValueDisplay</td>
                            @if (isAdmin)
                            {
                                <td>@item.CompanyIdList</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

<style>
    .reports-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .header-content {
        display: flex;
        flex-direction: column;
    }
    .btn-back {
        background-color: #6c757d;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }
    .btn-back:hover { background-color: #5a6268; color: white; }

    .filter-bar {
        display: flex;
        gap: 20px;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .filter-form { display: flex; gap: 10px; align-items: center; }

    .report-table-container { overflow-x: auto; }
    .report-table { width: 100%; border-collapse: collapse; }
    .report-table th, .report-table td { padding: 12px; border-bottom: 1px solid #eaeaea; text-align: left; }
    .report-table th { background: #f8f9fa; }

    .btn { display: inline-block; padding: 8px 16px; border-radius: 4px; color: white; text-decoration: none; }
    .btn-primary { background: #3498db; }
    .btn-primary:hover { background: #2980b9; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }

    .alert { padding: 15px; margin: 20px 0; border-radius: 5px; border: 1px solid transparent; }
    .alert-warning { background-color: #fff3cd; border-color: #ffeaa7; color: #856404; }
    .alert-info { background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
</style>
